<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treatment Record and Verify</title>
    <link rel="stylesheet" href="style_v2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1>Treatment</h1>
            <h2>Record and Verify mode</h2>
        </div>
        <div class="header-middle">
            <div class="user-info">
                <span>Primary User: hup</span>
                <span id="current-date"></span>
            </div>
            <div class="patient-orientation">
                <span>PATIENT ORIENTATION</span>
                <span id="patient-orientation">Head First, Supine</span>
            </div>
        </div>
        <div class="header-right">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Varian_Medical_Systems_logo.svg/320px-Varian_Medical_Systems_logo.svg.png" alt="Varian Medical Systems" class="logo">
        </div>
    </header>

    <div class="main-body">
        <aside class="patient-info-container">
            <div class="patient-details" id="patient-details-box">
                <p><strong>Name:</strong> <span id="pt-name">Loading...</span></p>
                <p><strong>ID:</strong> <span id="pt-id"></span></p>
                <p><strong>DOB:</strong> <span id="pt-dob"></span></p>
                <p><strong>Rad. Onc.:</strong> <span id="pt-physician"></span></p>
            </div>
            <div class="dose-details-header">
                <span>Dose Details</span>
            </div>
            <div class="treatment-list">
                <div class="list-header">
                    <span id="plan-id-header">Plan ID</span>
                    <span>Fx: <span id="fx-counter">1</span> of <span id="fx-total">-</span></span>
                </div>
                <ul id="field-list-items">
                    </ul>
            </div>
        </aside>

        <main class="content-right">
            <section class="machine-view-container">
                <div class="privacy-shade-label">Privacy Shade</div>
                <img src="https://www.veritas-medicalsolutions.com/wp-content/uploads/2021/06/C3-Flooring-Systems.png" alt="Machine View Live Stream">
                <div class="machine-overlay-text">To pause treatment, press Beam Off.</div>
                <div id="notification-area"></div>
            </section>

            <div class="treatment-flow-bar" id="workflow-bar">
                <div class="flow-step" id="btn-preview">Preview</div>
                <div class="flow-step" id="btn-prepare">Prepare</div>
                <div class="flow-step active-beam-on" id="btn-ready">Ready</div>
                <div class="flow-step" id="btn-beam-on">Beam On</div>
                <div class="flow-step" id="btn-record">Record</div>
            </div>

            <div class="treatment-data-container">
                <section class="treatment-fields-container">
                    <div class="container-header">
                        <span>Beam</span>
                        <span>Plan</span>
                        <span>Actual</span>
                    </div>
                    <div class="data-grid fields-grid" id="beam-parameters-grid">
                        <label>Beam Type</label>
                        <div class="value-box" id="beam-type-plan">-</div>
                        <div class="value-box" id="beam-type-actual">-</div>

                        <label>Energy Type</label>
                        <div class="value-box" id="energy-plan">-</div>
                        <div class="value-box" id="energy-actual">-</div>

                        <label>MU</label>
                        <div class="value-box highlighted" id="mu-total-plan">-</div>
                        <div class="mu-split" id="mu-split-actual">
                             <div class="mu-val" id="mu-actual-display">-</div>
                        </div>

                        <label>Dose Rate</label>
                        <div class="value-box" id="dose-rate-plan">-</div>
                        <div class="value-box" id="dose-rate-actual">-</div>

                        <label>Time (min)</label>
                        <div class="value-box" id="time-plan">-</div>
                        <div class="value-box" id="time-actual">-</div>

                        <label>Wedge</label>
                        <div class="value-box" id="wedge-plan">None</div>
                        <div class="value-box" id="wedge-actual">None</div>

                        <label>Bolus</label>
                        <div class="value-box" id="bolus-plan">None</div>
                        <div class="value-box" id="bolus-actual">None</div>
                    </div>
                </section>

                <section class="treatment-console-container">
                    <div class="container-header-split">
                        <div class="geo-header">
                            <span>Geometry</span>
                            <span>Plan</span>
                            <span>Actual</span>
                        </div>
                        <div class="bev-header">Beam's Eye View</div>
                    </div>
                    <div class="console-content">
                        <div class="data-grid geometry-grid" id="geometry-parameters-grid">
                            <label>Gantry Rtn</label>
                            <div class="value-box" id="gantry-plan">-</div>
                            <div class="value-box" id="gantry-actual">-</div>

                            <label>Coll Rtn</label>
                            <div class="value-box" id="coll-plan">-</div>
                            <div class="value-box" id="coll-actual">-</div>

                            <label>Couch Rtn</label>
                            <div class="value-box" id="couch-rtn-plan">-</div>
                            <div class="value-box" id="couch-rtn-actual">-</div>

                            <label style="height: 10px;"></label><div></div><div></div>

                            <label>Y1 (cm)</label>
                            <div class="value-box" id="y1-plan">-</div>
                            <div class="value-box" id="y1-actual">-</div>
                            <label>Y2 (cm)</label>
                            <div class="value-box" id="y2-plan">-</div>
                            <div class="value-box" id="y2-actual">-</div>
                            <label>X1 (cm)</label>
                            <div class="value-box" id="x1-plan">-</div>
                            <div class="value-box" id="x1-actual">-</div>
                            <label>X2 (cm)</label>
                            <div class="value-box" id="x2-plan">-</div>
                            <div class="value-box" id="x2-actual">-</div>

                             <label style="height: 10px;"></label><div></div><div></div>

                            <label>Couch Vrt</label>
                            <div class="value-box" id="couch-vrt-plan">-</div>
                            <div class="value-box" id="couch-vrt-actual">-</div>
                            <label>Couch Lng</label>
                            <div class="value-box" id="couch-lng-plan">-</div>
                            <div class="value-box" id="couch-lng-actual">-</div>
                            <label>Couch Lat</label>
                            <div class="value-box" id="couch-lat-plan">-</div>
                            <div class="value-box" id="couch-lat-actual">-</div>

                            <label>Pitch (°)</label>
                            <div class="value-box" id="couch-pitch-plan">-</div>
                            <div class="value-box" id="couch-pitch-actual">-</div>
                            <label>Roll (°)</label>
                            <div class="value-box" id="couch-roll-plan">-</div>
                            <div class="value-box" id="couch-roll-actual">-</div>
                        </div>
                        <div class="bev-graphic-container">
                            <canvas id="bev-canvas" width="300" height="300"></canvas>
                            <div class="bev-controls">
                                <span>MLC</span>
                                <button id="btn-mlc-mode">Static</button>
                            </div>
                        </div>
                    </div>
                    <div id="tolerance-warning" style="display: none;">Override Required: Parameters out of tolerance.</div>
                </section>
            </div>
        </main>
    </div>

    <footer class="status-tool-bar">
        <div class="tool-group left">
            <button class="wired-btn" id="btn-reorder">Reorder</button>
            <button class="wired-btn" id="btn-deactivate">Deactivate</button>
            <button class="wired-btn" id="btn-add">Add</button>
            <button class="wired-btn" id="btn-remove" disabled>Remove</button>
            <button class="primary-tool wired-btn" id="btn-tools">Tools</button>
            <button class="wired-btn" id="btn-setup-notes">Setup Notes</button>
            <button id="btn-close-patient">Close Patient</button>
        </div>
        <div class="tool-group right">
            <button class="wired-btn warning-btn" id="btn-override" disabled>Override</button>
            <button class="wired-btn" id="btn-acquire">Acquire</button>
            <button class="wired-btn" id="btn-edit">Edit</button>
            <button class="wired-btn" id="btn-goto">Go To</button>
            <button class="action-btn apply wired-btn" id="btn-apply">Apply</button>
            <button class="action-btn cancel wired-btn" id="btn-cancel">Cancel</button>
        </div>
    </footer>


    <div id="modal-add-imaging" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Add Imaging Field</h2>
            <p>Select imaging modality for the current field.</p>
            <div class="form-group">
                <label for="imaging-type">Modality:</label>
                <select id="imaging-type">
                    <option value="kV-kV Setup Pair">kV-kV Setup Pair</option>
                    <option value="CBCT">CBCT (Cone Beam CT)</option>
                    <option value="MV Port">MV Port Film</option>
                </select>
            </div>
            <div class="modal-actions">
                <button id="btn-confirm-add-imaging" class="action-btn apply">Add Imaging</button>
                <button class="action-btn cancel close-modal-btn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="modal-setup-notes" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>CT Simulation Setup Instructions</h2>
            <div id="setup-notes-content" class="notes-content">
                Loading notes...
            </div>
            <div class="modal-actions">
                <button class="action-btn apply close-modal-btn">Close</button>
            </div>
        </div>
    </div>

    <div id="modal-emr-tools" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>EMR Tools</h2>
            <div class="modal-tabs">
                <button class="modal-tab active">Patient Info</button>
                <button class="modal-tab">Documents</button>
                <button class="modal-tab">History</button>
            </div>
            <div class="modal-tab-content">
                <p>Placeholder for generic EMR patient information tabs.</p>
            </div>
            <div class="modal-actions">
                <button class="action-btn apply close-modal-btn">Close</button>
            </div>
        </div>
    </div>

     <div id="modal-override" class="modal">
        <div class="modal-content warning-content">
            <h2>Parameter Override Acknowledgment</h2>
            <p class="warning-text">WARNING: One or more actual parameters are outside the planned tolerance limits.</p>
            <p>By proceeding, you acknowledge these deviations and authorize treatment delivery.</p>
            <div class="form-group">
                <label for="therapist-id">Therapist ID / Signature:</label>
                <input type="text" id="therapist-id" placeholder="Enter ID">
            </div>
            <div class="modal-actions">
                <button id="btn-confirm-override" class="action-btn apply warning-btn">Confirm Override</button>
                <button class="action-btn cancel close-modal-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script src="patient_v2.js"></script>
</body>
</html>
