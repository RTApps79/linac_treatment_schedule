<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Details</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="study_embed.css">
</head>
<body>
    <div class="header-container">
        <header class="rt-header">
        <a href="index.html" class="back-link" title="Return to the schedule">&larr; Back to Schedule</a>

        <div class="header-center">
            <h1 id="patient-name-header">Patient Name (Loading...)</h1>
            <div class="header-meta">
                <span class="meta-pill" id="emulator-version-pill" title="Emulator build/version"></span>
                <span class="meta-pill" id="study-mode-pill" title="Current mode"></span>
            </div>
        </div>

        <div class="header-actions">
            <button id="prepare-open-btn" class="btn btn-primary" type="button" title="Open the daily verification checklist (marks scenario start in Study Mode)">Prepare</button>
            <button id="open-imaging-btn" class="btn btn-secondary" type="button"
                title="Open the Imaging screen for this same patient file in a new tab/window">
                Open Imaging Screen
            </button>
        </div>
    </header>
    </div>
    
    <div class="tabs-container">
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="summary">Summary</button>
            <button class="tab-button" data-tab="delivery">Treatment Delivery</button>
            <button class="tab-button" data-tab="billing">Billing (CPT)</button>
            <button class="tab-button" data-tab="plan">Treatment Plan</button>
            <button class="tab-button" data-tab="imaging">Imaging</button>
            <button class="tab-button" data-tab="records">Treatment Records</button>
            <button class="tab-button" data-tab="demographics">Demographics</button>
        </div>

        <div class="tab-content">
            <div id="summary" class="tab-pane active">
                </div>

            <div id="delivery" class="tab-pane">
                </div>

            <div id="billing" class="tab-pane">
                </div>

            <div id="imaging" class="tab-pane">
    <div class="imaging-container">
        <div class="imaging-views">
            <div class="image-viewer">
                <img alt="DRR Image" class="base-image" id="drr-image">
                <img alt="Overlay Image" class="overlay-image" id="kv-image-overlay">
            </div>
        </div>
        <div class="imaging-controls">
            <h3>Alignment Tools</h3>
            <div class="control-group">
                <label>Opacity/Fusion</label>
                <input type="range" min="0" max="100" value="50" class="control-slider" id="opacity-slider">
            </div>
            <div class="control-group">
                <label>Couch Translation (cm)</label>
                <div class="couch-controls">
                    <span>VRT</span>
                    <button class="control-btn" data-axis="y" data-dir="-1">&uarr;</button>
                    <input type="text" class="axis-input" id="y-axis" value="0.0" readonly>
                    <button class="control-btn" data-axis="y" data-dir="1">&darr;</button>
                </div>
                <div class="couch-controls">
                    <span>LAT</span>
                    <button class="control-btn" data-axis="x" data-dir="-1">&larr;</button>
                    <input type="text" class="axis-input" id="x-axis" value="0.0" readonly>
                    <button class="control-btn" data-axis="x" data-dir="1">&rarr;</button>
                </div>
                <div class="couch-controls">
                    <span>LNG</span>
                    <button class="control-btn" data-axis="z" data-dir="-1">&uarr;</button>
                    <input type="text" class="axis-input" id="z-axis" value="0.0" readonly>
                    <button class="control-btn" data-axis="z" data-dir="1">&darr;</button>
                </div>
            </div>
             <div class="control-group">
                <label>Couch Rotation (°)</label>
                 <div class="couch-controls">
                    <span>PITCH</span>
                    <button class="control-btn" data-axis="pitch" data-dir="-1">&#8635;</button>
                    <input type="text" class="axis-input" id="pitch-axis" value="0.0" readonly>
                    <button class="control-btn" data-axis="pitch" data-dir="1">&#8634;</button>
                </div>
            </div>
            <div class="action-buttons">
                <button class="control-btn-action" id="reset-shifts">Reset</button>
                <button class="control-btn-action" id="apply-shifts">Apply Shifts</button>
            </div>
            <div id="shift-confirmation" class="confirmation-message"></div>
        </div>
    </div>
</div>

            <div id="plan" class="tab-pane"></div>
            <div id="records" class="tab-pane"></div>
            <div id="demographics" class="tab-pane"></div>
        </div>
    </div>

    <script src="study_config.js"></script>
    <script src="study_capture.js"></script>
    <script src="study_embed.js"></script>
    <script src="patient.js"></script>

    <!-- Prepare / verification checklist modal (marks scenario start) -->
    <div id="prepare-modal" class="modal-overlay" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="prepare-title">
            <div class="modal-header">
                <div class="modal-title" id="prepare-title">Daily Treatment Verification</div>
                <button type="button" class="modal-close" id="prepare-close" aria-label="Close">×</button>
            </div>

            <div class="modal-body">
                <div class="checklist">
                    <label class="check-item"><input type="checkbox" class="prep-check"> Patient ID verified</label>
                    <label class="check-item"><input type="checkbox" class="prep-check"> Plan / treatment site confirmed</label>
                    <label class="check-item"><input type="checkbox" class="prep-check"> Setup / indexing confirmed</label>
                    <label class="check-item"><input type="checkbox" class="prep-check"> Machine clearance visually verified</label>
                    <label class="check-item"><input type="checkbox" class="prep-check"> Alerts / interlocks reviewed</label>
                </div>

                <p class="modal-hint">
                    When ready, select <strong>Confirm Ready</strong>. This marks the start of the console verification task for study timing.
                </p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="prepare-cancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="prepare-confirm" disabled>Confirm Ready</button>
            </div>
        </div>
    </div>

</body>
</html>
